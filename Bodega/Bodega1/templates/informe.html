{% extends 'base.html' %}

{% block title %}Informes - Sistema Inventario{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">
                        <i class="bi bi-graph-up"></i> Informes del Sistema
                    </h4>
                </div>
            </div>
        </div>
    </div>

    <!-- Tarjetas de Resumen -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="card text-white bg-success h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title">
                                <i class="bi bi-box"></i> Total Productos
                            </h6>
                            <h2 class="mb-0">{{ total_productos }}</h2>
                        </div>
                        <i class="bi bi-box display-4 opacity-50"></i>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3 mb-3">
            <div class="card text-white bg-info h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title">
                                <i class="bi bi-boxes"></i> Total Stock
                            </h6>
                            <h2 class="mb-0">{{ total_stock }}</h2>
                            <small>unidades</small>
                        </div>
                        <i class="bi bi-boxes display-4 opacity-50"></i>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3 mb-3">
            <div class="card text-white bg-warning h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title">
                                <i class="bi bi-currency-dollar"></i> Valor Inventario
                            </h6>
                            <h2 class="mb-0">${{ valor_inventario|floatformat:2 }}</h2>
                        </div>
                        <i class="bi bi-currency-dollar display-4 opacity-50"></i>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3 mb-3">
            <div class="card text-white bg-danger h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title">
                                <i class="bi bi-exclamation-triangle"></i> Stock Bajo
                            </h6>
                            <h2 class="mb-0">{{ productos_stock_bajo|length }}</h2>
                            <small>productos</small>
                        </div>
                        <i class="bi bi-exclamation-triangle display-4 opacity-50"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Productos con Stock Bajo -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-danger text-white">
                    <h5 class="mb-0">
                        <i class="bi bi-exclamation-triangle"></i> Productos con Stock Bajo (< 10 unidades)
                        <span class="badge bg-light text-danger ms-2">{{ productos_stock_bajo|length }}</span>
                    </h5>
                </div>
                <div class="card-body">
                    {% if productos_stock_bajo %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-danger">
                                <tr>
                                    <th><i class="bi bi-hash"></i> ID</th>
                                    <th><i class="bi bi-fonts"></i> Nombre</th>
                                    <th><i class="bi bi-boxes"></i> Stock Actual</th>
                                    <th><i class="bi bi-currency-dollar"></i> Precio Unitario</th>
                                    <th><i class="bi bi-calculator"></i> Valor en Stock</th>
                                    <th><i class="bi bi-tag"></i> Categoría ID</th>
                                    <th><i class="bi bi-lightning-charge"></i> Acción</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for producto in productos_stock_bajo %}
                                <tr class="table-warning">
                                    <td><span class="badge bg-secondary">{{ producto.id }}</span></td>
                                    <td>{{ producto.nombre }}</td>
                                    <td>
                                        <span class="badge bg-danger">
                                            {{ producto.stock }} <i class="bi bi-exclamation-triangle"></i>
                                        </span>
                                    </td>
                                    <td>${{ producto.precio|floatformat:2 }}</td>
                                    <td>${{ producto.stock|floatformat:2 }}</td>
                                    <td><span class="badge bg-info">{{ producto.categoria_id }}</span></td>
                                    <td>
                                        <a href="{% url 'gestion_movimientos' %}" class="btn btn-sm btn-success">
                                            <i class="bi bi-arrow-down-circle"></i> Ingresar
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="text-center py-4">
                        <i class="bi bi-check-circle display-4 text-success"></i>
                        <p class="text-success mt-3">¡Excelente! No hay productos con stock bajo.</p>
                        <p class="text-muted">Todos los productos tienen stock suficiente.</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Filtros Avanzados -->
    <div class="row">
        <div class="col-lg-6">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">
                        <i class="bi bi-funnel"></i> Filtros Avanzados
                    </h5>
                </div>
                <div class="card-body">
                    <form method="get" action="#">
                        <div class="mb-3">
                            <label class="form-label">
                                <i class="bi bi-sliders"></i> Productos con stock menor a:
                            </label>
                            <div class="input-group">
                                <input type="number" 
                                       class="form-control" 
                                       name="stock_min" 
                                       value="10"
                                       min="0">
                                <span class="input-group-text">unidades</span>
                                <button type="submit" class="btn btn-primary">
                                    <i class="bi bi-filter"></i> Filtrar
                                </button>
                            </div>
                        </div>
                    </form>
                    
                    <div class="alert alert-info">
                        <i class="bi bi-lightbulb"></i> 
                        <strong>Consejo:</strong> Define un límite de stock para identificar 
                        productos que necesitan reabastecimiento.
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-6">
            <div class="card">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0">
                        <i class="bi bi-pie-chart"></i> Estadísticas Rápidas
                    </h5>
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span>
                                <i class="bi bi-check-circle text-success"></i>
                                Productos activos
                            </span>
                            <span class="badge bg-success rounded-pill">{{ total_productos }}</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span>
                                <i class="bi bi-currency-dollar text-primary"></i>
                                Valor promedio por producto
                            </span>
                            <span class="badge bg-primary rounded-pill">
                                ${% if total_productos > 0 %}{{ valor_inventario|floatformat:2 }}{% else %}0.00{% endif %}
                            </span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span>
                                <i class="bi bi-box text-info"></i>
                                Stock promedio por producto
                            </span>
                            <span class="badge bg-info rounded-pill">
                                {% if total_productos > 0 %}{{ total_stock|floatformat:0 }}{% else %}0{% endif %}
                            </span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span>
                                <i class="bi bi-percent text-warning"></i>
                                Porcentaje de stock bajo
                            </span>
                            <span class="badge bg-warning rounded-pill">
                                {% if total_productos > 0 %}
                                {{ (productos_stock_bajo|length / total_productos * 100)|floatformat:1 }}%
                                {% else %}0%{% endif %}
                            </span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Recomendaciones -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">
                        <i class="bi bi-lightbulb"></i> Recomendaciones
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <i class="bi bi-arrow-down-circle display-4 text-success"></i>
                                    <h5 class="mt-3">Reabastecer</h5>
                                    <p class="text-muted">
                                        Productos con stock bajo necesitan ingreso inmediato.
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <i class="bi bi-graph-up display-4 text-primary"></i>
                                    <h5 class="mt-3">Analizar Ventas</h5>
                                    <p class="text-muted">
                                        Productos con mayor rotación requieren más stock.
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <i class="bi bi-clock-history display-4 text-info"></i>
                                    <h5 class="mt-3">Monitorear</h5>
                                    <p class="text-muted">
                                        Revisar informes periódicamente para mantener stock óptimo.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Actualizar estadísticas dinámicas
    const totalProductos = {{ total_productos }};
    const productosStockBajo = {{ productos_stock_bajo|length }};
    
    if (totalProductos > 0) {
        const porcentajeBajo = (productosStockBajo / totalProductos * 100).toFixed(1);
        const porcentajeElement = document.querySelector('.badge.bg-warning.rounded-pill:last-child');
        if (porcentajeElement) {
            porcentajeElement.textContent = porcentajeBajo + '%';
        }
    }
});
</script>
{% endblock %}